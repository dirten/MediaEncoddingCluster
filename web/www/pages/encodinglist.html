<link rel="stylesheet" media="screen" href="omnigrid/omnigrid.css" type="text/css" />
<!--
<script type="text/javascript" src="scripts/mootools-1.2-core.js"></script>
<script type="text/javascript" src="scripts/mootools-1.2-more.js"></script>
<script type="text/javascript" src="../omnigrid/omnigrid.js"></script>
-->

									    
<script type="text/javascript">

  function onGridSelect(evt)
  {
        var url='/api/encoding';
        var request = new Request.JSON({
          url: url,
          method: 'get',
          onComplete: function(properties) {
            var l=properties.id;
              setEncodingDetails(properties);
          }
        }).send(evt.target.getDataByRow(evt.row).id);
  }

  function gridButtonClick(button, grid)
  {
    alert(button);
  }

  var cmu = [
    {
      header: "Encoding Id",
      dataIndex: 'id',
      dataType:'string',
      width:230
    },
    {
      header: "Created",
      dataIndex: 'created',
      dataType:'string',
      width:110
    },
    {
      header: "Started",
      dataIndex: 'begintime',
      dataType:'string',
      width:110
    },
    {
      header: "Finished",
      dataIndex: 'endtime',
      dataType:'string',
      width:110
    },
    {
      header: "% Progress",
      dataIndex: 'progress',
      dataType:'string',
      width:110
    },
    {
      header: "Status",
      dataIndex: 'status',
      dataType:'string',
      width:110
    }

  ];
      function accordionFunction(obj){
        //obj.parent.set('html', '<div style="padding:5px"> Row '+obj.parent.constructor+'<br/><br/>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. </div>');
        //obj.parent.set('html', '<div style="padding:5px"> Row '+inspect(obj.parent)+'<br/></div>');
        //obj.parent.appendChild(new Element('div',{id:'id', text:obj.rowdata.profile}));
        //alert(obj.rowdata.xml);
        //alert('Parser');
        //parser=new DOMParser();
        //alert(parser);
        /*
        xmlDoc=parser.parseFromString(obj.rowdata.xml,"text/xml");
        alert(xmlDoc);
        xsl='<xsl:stylesheet version="1.0"
         xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
          <xsl:output omit-xml-declaration="yes" indent="yes"/>

              <xsl:template match="node()|@*">
                    <xsl:copy>
                            <xsl:apply-templates select="node()|@*"/>
                                  </xsl:copy>
                                      </xsl:template>
                                      </xsl:stylesheet>';
        xslDoc=parser.parseFromString(xsl,"text/xml");
        alert(xmlDoc);
         */
        //obj.parent.appendChild(new Element('code',{class:'prettyprint', id:'json', text:obj.rowdata.profile}));
        var data=new Object();
        if(obj.rowdata.profile!=undefined && obj.rowdata.profile.length>10)
            data=JSON.decode(obj.rowdata.profile);
        
        obj.parent.set('html','<div style="padding:5px"><b>Input File : </b><span>'+obj.rowdata.infile+'</span><br/>\n\
                                <b>Output File : </b><span>'+obj.rowdata.outfile+'</span><br/>\n\
                                <b>Profile Name : </b><span>'+data.name+'</span><br/></div>');
        //obj.parent.appendChild(new Element('div',{text:'<b>Input File</b><span>'+obj.rowdata.outfile+'</span>'}));
        //obj.parent.set('html','<code class="prettyprint">'+obj.rowdata.xml+'</code>');
        //prettyPrint();
    }

  window.addEvent("domready", function(){

    var datagrid = new omniGrid('encodinggrid', {
      columnModel: cmu,
      
      buttons : [
        {name: 'Add', bclass: 'add', id:'add', onclick : gridButtonClick},
        {name: 'Delete', bclass: 'delete', onclick : gridButtonClick},
        {separator: true},
        {name: 'Duplicate', bclass: 'duplicate', onclick : gridButtonClick}
      ],
      url:"/api/encoding",
      perpage:10,
      page:1,
      pagination:false,
      serverSort:false,
      showHeader: true,
      alternaterows: true,
      showHeader:true,
      sortHeader:true,
      resizeColumns:true,
      multipleSelection:false,
      width:800,
      height: null
      //accordion:true,
      //accordionRenderer:accordionFunction,
    });
   
    datagrid.addEvent('click', onGridSelect);
    $('add').setProperty('disabled', true);

    //var myRefresh = function(){  this.refresh();};
    //myRefresh.periodical(2000, datagrid);
    //datagrid.refresh.periodical(2000);
  });

</script>

<div id="encodinggrid" ></div>
