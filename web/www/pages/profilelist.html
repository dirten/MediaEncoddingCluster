<style>

    .omnigrid div.fbutton .add {
        background:transparent url(images/add-new.png) no-repeat scroll left center;
    }

    .omnigrid div.fbutton .delete {
        background:transparent url(images/delete-new.png) no-repeat scroll left center;
    }
</style>

<script type="text/javascript">
    var profileModel=null;
    function onGridSelect(evt)
    {
        /*
    var str = 'row: '+evt.row+' indices: '+evt.indices;
    str += ' id: '+evt.target.getDataByRow(evt.row).id;

    alert( str );
         */
        //  alert('hier');
        var url='/api/profile';
        var request = new Request.JSON({
            url: url,
            method: 'get',
            onComplete: function(properties) {
                setProfileDetails(properties);
            }
        }).send("id="+evt.target.getDataByRow(evt.row).id);
        selectedItem=evt.target.getDataByRow(evt.row);


    }
    function openProfileForm(evt){
        MochaUI.profileWindow(evt.target.getDataByRow(evt.row).id);
        return;
        var mytest=new MochaUI.Window({
            id: 'profileWindow',
            title: 'Profile Builder',
            icon: 'images/icons/page.gif',
            scrollbars:true,
            loadMethod: 'xhr',
            toolbar:true,
            toolbarURL: 'pages/profile-tabs.html',
            toolbar2:true,
            toolbar2URL: 'pages/profile-controls.html',
            onContentLoaded: function(){
                new Request.JSON({
                    url: '/api/profile',
                    method: 'get',
                    onComplete: function(properties) {
                        //setProfileFormData(properties);
                        if(firstLoad){
                            profileModel=properties;
                            //alert(profileModel);
                            firstLoad=false;
                        }
                    }
                }).send("id="+evt.target.getDataByRow(evt.row).id);
                //        $('profileId').set('value',evt.target.getDataByRow(evt.row).id);
            },
            width: 500,
            height: 600,
            maximizable: false,
            resizable: false,
            scrollbars: false
        });
    
    }


    function gridButtonClick(button, grid)
    {
        if(button=='delete'){
            Check = confirm("do you really want to delete the selected profile");
            if(Check==true){
            new Request.JSON({
                url: '/api/profile?id='+selectedItem.id,
                method: 'DELETE',
                onComplete: function(props) {
                    if(props.ok){
                        MochaUI.notification('Profile deleted');
                        profilegrid.refresh();
                    }else{
                        MochaUI.notification('Error: '+props.error.description);
                    }
                }
            }).send();
        }
        }else if(button='add'){
            MochaUI.profileWindow("");
        }
    }

    var cmu = [
        {
            header: "Profile Id",
            dataIndex: 'id',
            dataType:'string',
            width:230
        },
        {
            header: "Profile Name",
            dataIndex: 'profilename',
            dataType:'string',
            width:550
        },

    ];
    function accordionFunction(obj){
        //obj.parent.set('html', '<div style="padding:5px"> Row '+obj.parent.constructor+'<br/><br/>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. </div>');
        //obj.parent.set('html', '<div style="padding:5px"> Row '+inspect(obj.parent)+'<br/></div>');
	
        obj.parent.appendChild(new Element('div',{id:'id', text:obj.rowdata.id}));
        //alert(obj.rowdata.xml);
        //alert('Parser');
        parser=new DOMParser();
        alert(parser);
        /*
        xmlDoc=parser.parseFromString(obj.rowdata.xml,"text/xml");
        alert(xmlDoc);
        xsl='<xsl:stylesheet version="1.0"
         xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
          <xsl:output omit-xml-declaration="yes" indent="yes"/>
	  
              <xsl:template match="node()|@*">
                    <xsl:copy>
                            <xsl:apply-templates select="node()|@*"/>
                                  </xsl:copy>
                                      </xsl:template>
                                      </xsl:stylesheet>';
        xslDoc=parser.parseFromString(xsl,"text/xml");
        alert(xmlDoc);
         */
        //obj.parent.appendChild(new Element('code',{class:'prettyprint lang-xml', id:'xml', text:obj.rowdata.xml}));
        //obj.parent.set('html','<code class="prettyprint">'+obj.rowdata.xml+'</code>');
        //prettyPrint();
    }

    window.addEvent("domready", function(){
        profilegrid = new omniGrid('encodinggrid', {
            columnModel: cmu,
      
            buttons : [
                {name: 'Create new Profile', bclass: 'add', onclick : gridButtonClick},
                {name: 'Delete selected Profile', bclass: 'delete', onclick : gridButtonClick},
                //{separator: true},
                //{name: 'Duplicate', bclass: 'duplicate', onclick : gridButtonClick}
            ],
            url:MochaUI.baseApiUrl+"/profile",
            method:'get',
            perpage:10,
            page:1,
            pagination:false,
            serverSort:false,
            showHeader: true,
            alternaterows: true,
      
            sortHeader:true,
            resizeColumns:true,
            multipleSelection:false,
            // accordion:true,
            // accordionRenderer:accordionFunction,

            // uncomment this if you want accordion behavior for every row
            /*
                accordion:true,
                accordionRenderer:accordionFunction,
                autoSectionToggle:false,
             */

            //width:800,
            height: null
        });

        profilegrid.addEvent('click', onGridSelect);
        profilegrid.addEvent('dblclick', openProfileForm);
        //    profilegrid.addEvent('click', setItem);
        $('createNewProfileButton').addEvent('click', function(e){
            new Event(e).stop();
            MochaUI.profileWindow();
        });
        /*
    $('deleteProfileButton').addEvent('click', function(e){
      new Event(e).stop();
      if(selectedItem!=null&&selectedItem.id!=null){
        if(confirm("Do you really want to delete the Profile Entry with the Id "+selectedItem.id+"?")){
          new Request.JSON({

          url: '/api/profile/get',
          method: 'POST',
          onComplete: function(props) {
            if(props.ok){
              MochaUI.notification('Profile deleted');
              profilegrid.refresh();
            }else{
              MochaUI.notification('Error: '+props.error);
            }
          }
        }).send("{\"action\":\"delete\",\"profileId\":\""+selectedItem.id+"\"}");
      }
    }else{
      alert("please select an Item in the Profile List!");
    }
    selectedItem=null;
  });
         */

    });

</script>
<!--<button class="add" id="createNewProfileButton">Create Profile ...</button>
<button class="delete" id="deleteProfileButton">Delete selected Profile...</button>-->
<div id="encodinggrid" ></div>
