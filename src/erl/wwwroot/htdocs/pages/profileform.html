<form id="profileForm" action="/api/json/profile" method="POST">
  <input type="hidden" class="hidden" name="profileId" id="profileId" value="-1"  />
	<div class="formLabel">Name:</div>
	<div class="formField"><input type="text" class="input" name="profileName" id="profileName" value="new Profile" maxlength="38" /></div>
	<div class="clear"></div>

	<div class="formLabel">Extension:</div>
	<div class="formField"><input type="text" class="input" name="profileExtension" id="profileExtension" value="avi" maxlength="38" /></div>
	<div class="clear"></div>

	<div class="formLabel">Format:</div>
	<div class="formField"><select class="input" name="profileFormat" id="profileFormat" value=""></select></div>
	<div class="clear"></div>

	<div class="formLabel">Video Codec:</div>
  <div class="formField"><select class="input" name="profileVideoCodec" id="profileVideoCodec" value=""></select></div>
	<div class="clear"></div>

  <div class="formLabel">Video Bitrate:</div>
	<div class="formField"><input type="text" class="input number" name="profileVideoBitrate" id="profileVideoBitrate" value="" maxlength="8" /><div class="lite">value in KB e.g. (1024)</div></div>
	<div class="clear"></div>

  <div class="formLabel" >Video Framerate:</div>
	<div class="formField">
    <select class="input" name="profileVideoFramerate" id="profileVideoFramerate" value=""></select>
<!--    <select name="profileVideoFramerate" id="profileVideoFramerate" class="input" >
      <option>0.09</option>
      <option>5.995</option>
      <option>7.5</option>
      <option>7.992</option>
      <option>8.0</option>
      <option>10.0</option>
      <option>11.998</option>
      <option>12.0</option>
      <option>14.985</option>
      <option>15.0</option>
      <option>20.0</option>
      <option>23.98</option>
      <option>24.0</option>
      <option>25.0</option>
      <option>29.97</option>
      <option>30.0</option>
    </select>-->
  </div>
	<div class="clear"></div>

	<div class="formLabel">Video Width:</div>
	<div class="formField"><input type="text" class="input number" name="profileVideoWidth" id="profileVideoWidth" value="300" maxlength="4" /></div>
	<div class="clear"></div>

	<div class="formLabel">Video Height:</div>
	<div class="formField"><input type="text" class="input number" name="profileVideoHeight" id="profileVideoHeight" value="125" maxlength="4" /></div>
	<div class="clear"></div>

	<div class="formLabel">Audio Channels:</div>
	<div class="formField"><input type="text" class="input number" name="profileAudioChannels" id="profileAudioChannels" value="" maxlength="4" /></div>
	<div class="clear"></div>

	<div class="formLabel">Audio Codec:</div>
  <div class="formField"><select class="input" name="profileAudioCodec" id="profileAudioCodec" value="" maxlength="4" ></select></div>
	<div class="clear"></div>

	<div class="formLabel">Audio Bitrate:</div>
	<div class="formField"><input type="text" class="input number" name="profileAudioBitrate" id="profileAudioBitrate" value="" maxlength="4" /></div>
	<div class="clear"></div>

  <div class="formLabel">Audio Samplerate:</div>
	<div class="formField"><select class="input" name="profileAudioSamplerate" id="profileAudioSamplerate" value=""></select>
    </div>
	<div class="clear"></div>

  <div class="formLabel">2 Pass Encoding:</div>
	<div class="formField"><input type="text" class="input number" name="profileMultipass" id="profileMultipass" value="" maxlength="4" /></div>
	<div class="clear"></div>

  <div class="formLabel">Group of Picture size:</div>
	<div class="formField"><input type="text" class="input number" name="profileGop" id="profileGop" value="" maxlength="4" /></div>
	<div class="clear"></div>

	<div class="formLabel"></div>
	<div class="formField">
    <input type="submit" class="submit" id="profileSubmit" value="Save Profile" />
    <input type="submit" class="submit" id="profileCancel" value="Cancel" /></div>
  <div class="clear"></div>
</form>
<script type="text/javascript">
  function setProfileCodecData(props,vcodec,acodec){
    $each(props,function(prop){
      if(prop.type==0){
        var el = new Element('option',{'text':prop.name, 'value':prop.id}).inject($('profileVideoCodec'));
        if(prop.id==vcodec)
          el.set('selected');

      }
      if(prop.type==1){
        var el = new Element('option',{'text':prop.name, 'value':prop.id}).inject($('profileAudioCodec'));
        if(prop.id==acodec)
          el.set('selected');
      }
    });
  }
  function setProfileFormatData(props, selected){
    $each(props,function(prop){
      var el=new Element('option',{'text':prop.long_name, 'value':prop.name}).inject($('profileFormat'));
      if(prop.name==selected)
        el.set('selected');
    });
  }
  function setProfileSampleRateData(props, selected){
    $each(props,function(prop){
      var el=new Element('option',{'text':prop+' Hz', 'value':prop}).inject($('profileAudioSamplerate'));
      if(prop==selected)
        el.set('selected');
    });
  }
  function setProfileFrameRateData(props, selected){
    $each(props,function(prop){
      var el=new Element('option',{'text':prop+' fps', 'value':prop}).inject($('profileVideoFramerate'));
      if(prop==selected)
        el.set('selected');
    });
  }
  function setProfileFormData(props){
    new Request.JSON({
      url: '/api/json/codec',
      method: 'get',
      onComplete: function(properties) {
        if(props==null)
          setProfileCodecData(properties.data,null, null);
        else
          setProfileCodecData(properties.data,props.vcodec, props.acodec);
      }
    }).send();
    new Request.JSON({
      url: '/api/json/format',
      method: 'get',
      onComplete: function(properties) {
        if(props==null)
          setProfileFormatData(properties.data,null);
        else
          setProfileFormatData(properties.data,props.vformat);
      }
    }).send();
    new Request.JSON({
      url: '/api/json/config?key=samplerates',
      method: 'get',
      onComplete: function(properties) {
        if(props==null)
          setProfileSampleRateData(properties.samplerates,null);
        else
          setProfileSampleRateData(properties.samplerates,props.asamplerate);
      }
    }).send();
    new Request.JSON({
      url: '/api/json/config?key=framerates',
      method: 'get',
      onComplete: function(properties) {
        if(props==null)
          setProfileFrameRateData(properties.framerates,null);
        else
          setProfileFrameRateData(properties.framerates,props.vframerate);
      }
    }).send();

    if(props==null)return;
    //    alert(props.vbitrate);
    $('profileId').set('value',props.id);
    $('profileName').set('value',props.name);
    $('profileExtension').set('value',props.ext);
    $('profileVideoBitrate').set('value',props.vbitrate);
    $('profileVideoWidth').set('value',props.vwidth);
    $('profileVideoHeight').set('value',props.vheight);
    $('profileAudioChannels').set('value',props.achannels);
    $('profileAudioBitrate').set('value',props.abitrate);
    $('profileAudioSamplerate').set('value',props.asamplerate);
    $('profileMultipass').set('value',props.multipass);
    $('profileGop').set('value',props.gop);
    optionList=$$('#profileVideoFramerate option');
    $each(optionList,function(option){
      if(option.get('text')==props.vframerate){
        option.set('selected');
      }
    });
    
    /*
optionList2=$('profileFormat').getChildren();
    alert(optionList2);
    alert('bla');
    $each(optionList,function(option){
      if(option.get('value')==props.vformat){
        option.set('selected');
      }
    });*/
  }

  window.addEvent("domready", function(){


    $('profileSubmit').addEvent('click', function(e){
      new Event(e).stop();
      new Event(e).stop();
      var json=form2json($('profileForm'));
      //      alert(json);
      new Request.JSON({
        url: '/api/json/profile',
        method: 'POST',
        onComplete: function(props) {
          if(props.ok){
            MochaUI.closeWindow($('profile'));
            MochaUI.notification('Profile Updated');
            profilegrid.refresh();
          }else{
            MochaUI.notification('Error: '+props.error);
          }
        }
      }).send(json);
    });
    $('profileCancel').addEvent('click', function(e){
      new Event(e).stop();
      MochaUI.closeWindow($('profile'));
//      MochaUI.notification('Profile Update Canceled');
    });
  });
</script>