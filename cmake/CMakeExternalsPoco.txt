
set(BUILD_DIR "${CMAKE_CURRENT_BINARY_DIR}/build")


IF(MINGW)
  SET(USER_CONFIG "--config=MinGW-w64")
ENDIF(MINGW)

ExternalProject_Add(poco
  URL http://pocoproject.org/releases/poco-1.4.6/poco-1.4.6p2-all.tar.gz
  CONFIGURE_COMMAND CFLAGS=-fPIC && CXXFLAGS=-fPIC && <SOURCE_DIR>/configure --prefix=${BUILD_DIR} ${USER_CONFIG} --static --no-tests --no-samples --cflags=-fPIC --omit=Data/ODBC,Data/MySQL,NetSSL_OpenSSL,Crypto,PageCompiler
  BUILD_IN_SOURCE 1
)
#--cflags=-mmacosx-version-min=10.7 
IF(MINGW)
  ExternalProject_Add_Step(poco setup_poco_config_mingw
    COMMAND ${CMAKE_COMMAND} -E copy ${CMAKE_SOURCE_DIR}/cmake/MinGW-w64 <SOURCE_DIR>/build/config/MinGW-w64
    DEPENDEES download
    DEPENDERS configure
  )
ENDIF(MINGW)

string(TOLOWER ${CMAKE_BUILD_TYPE} LOWERCASE_CMAKE_BUILD_TYPE)
#if (LOWERCASE_CMAKE_BUILD_TYPE STREQUAL "debug" AND NOT SHARED_CORE)
IF(LOWERCASE_CMAKE_BUILD_TYPE STREQUAL "debug")
    message("debug mode")
    SET(POCO_LIBRARY_SUFFIX "d.a")
  ELSE(LOWERCASE_CMAKE_BUILD_TYPE STREQUAL "debug")
    SET(POCO_LIBRARY_SUFFIX ".a")
ENDIF(LOWERCASE_CMAKE_BUILD_TYPE STREQUAL "debug")

SET(POCO_DIR "${BUILD_DIR}")
SET(POCO_LIB_FOUNDATION ${BUILD_DIR}/lib/libPocoFoundation${POCO_LIBRARY_SUFFIX})
SET(POCO_LIB_NET ${BUILD_DIR}/lib/libPocoNet${POCO_LIBRARY_SUFFIX})
SET(POCO_LIB_NET_UTIL ${BUILD_DIR}/lib/libPocoUtil${POCO_LIBRARY_SUFFIX})
SET(POCO_LIB_XML ${BUILD_DIR}/lib/libPocoXML${POCO_LIBRARY_SUFFIX})
SET(POCO_LIB_ZIP ${BUILD_DIR}/lib/libPocoZip${POCO_LIBRARY_SUFFIX})

